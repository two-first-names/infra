---
- name: Add Authentik Helm repository
  helm_repository:
    name: authentik
    repo_url: https://charts.goauthentik.io
- name: Install Authentik
  helm:
    name: authentik
    release_namespace: authentik
    chart_ref: authentik/authentik
    values:
      authentik:
        secret_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          65376632653966653833646137343163303235396235346330313966633264396563623333656130
          6161643338653339623230663831346664653261393863610a663634633365383336373238323036
          32383031333234353531366634663766393036616636363838646466616263333436306333626535
          3466363362303135620a323132666631303231393633363232616335643639356331316639346633
          61323630366632383761626164656163636137346136656461313565343232336236313432613539
          63636234626337343363313064653337383363383739653830623432643365383364396665663237
          386264383939316631663637633265613662
        # This sends anonymous usage-data, stack traces on errors and
        # performance data to sentry.io, and is fully opt-in
        error_reporting:
          enabled: true
        postgresql:
          password: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            31633565303231613366336235633437366330316336313437663234383366323664313465636463
            3831326265626463623464393832613531303063333632310a363562666664383530623431383164
            61353938646166323534616563653738363430643131313938336166366536636362323765323634
            3065353235396561350a623634343065623665323563633734333262623062303262626432633866
            33386463353831343232616637373261613338663339646164383038643839373766303936326363
            32356666613262313761313336396465316665333337353335313636353132353166336436323561
            633364666434373534393833353138366536

      ingress:
        # Specify kubernetes ingress controller class name
        ingressClassName: traefik
        enabled: true
        hosts:
          # Specify external host name
          - host: auth.engiqueer.net
            paths:
              - path: "/"
                pathType: Prefix

      postgresql:
        enabled: true
        postgresqlPassword:  !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31633565303231613366336235633437366330316336313437663234383366323664313465636463
          3831326265626463623464393832613531303063333632310a363562666664383530623431383164
          61353938646166323534616563653738363430643131313938336166366536636362323765323634
          3065353235396561350a623634343065623665323563633734333262623062303262626432633866
          33386463353831343232616637373261613338663339646164383038643839373766303936326363
          32356666613262313761313336396465316665333337353335313636353132353166336436323561
          633364666434373534393833353138366536
      redis:
        enabled: true
